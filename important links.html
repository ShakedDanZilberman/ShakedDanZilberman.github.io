<!DOCTYPE html>
<html lang="en" dir="ltr">

    <head>
        <meta charset="utf-8">
        <title>Important Links - Talpiot 45 2023</title>
        <style media="screen">
            body {
                margin: 0;
                width: 100%;
                height: 100%;
                overflow: hidden;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }

            div.container {
                background-color: white;
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                align-items: center;
                text-align: center;
                min-height: 100vh;
                overflow: hidden;
                gap: 2vw;
                flex-direction: row;
                align-content: flex-start;
            }

            div.blob {
                width: 14vw;
                height: 14vw;
                border: .1vh solid gray;
                backdrop-filter: brightness(0.9);
                padding: 1vw;
                display: flex;
                align-content: stretch;
                align-items: center;
                flex-direction: column;
                justify-content: space-around;
                border-radius: 5%;
                cursor: pointer;
            }

            div.blob>h1,
            div.blob>h2 {
                margin: 0;
                width: 100%;
            }

            div.blob>h1 {
                font-size: 1.8vw;
            }

            div.blob>h2 {
                font-size: 1.2vw;
                overflow: hidden;
                font-weight: normal;
                font-style: italic;
            }

            div.blob>h1>i {
                font-family: "Consolas", monospace;
            }

            i {
                font-style: normal;
            }

            div.blob>img {
                width: 50%;
                height: auto;
                border-radius: 50%;
            }

            .blob {
                position: relative;
            }

            .blob::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: -1;
            }

            h3 {
                top: 5%;
                text-align: center;
                width: 100%;
                font-size: 5vw;
                margin: 0;
                z-index: 1;
                text-transform: capitalize;
                display: flex;
                justify-content: center;
                align-items: center;
            }

            img#favicon {
                height: 5vw;
                width: 5vw;
                margin-right: 2vw;
                padding-top: 0.5vw;
            }

            div.all {
                position: absolute;
                width: 100vw;
                height: 10vw;
                bottom: -2vw;
                display: flex;
                justify-content: center;
                align-items: center;
            }

            div#all {
                cursor: pointer;
                backdrop-filter: brightness(0.8);
                display: flex;
                align-content: stretch;
                align-items: center;
                flex-direction: column;
                justify-content: space-around;
                width: 19vw;
                height: 4vw;
                font-size: 1.5vw;
                font-weight: bold;
                box-shadow: inset 0 0 10px 10px white;
            }
        </style>
    </head>

    <body>
        <h3><i id="title">Important Links - Talpiot 45 2023</i></h3>
        <div class="container" id="container"></div>
        <div class="all">
            <div id="all" onclick="openAll();">
                All
            </div>
        </div>
        <script>
            String.prototype.capitalise = function () {
                return this.split(" ").map(function (ele) { return ele[0].toUpperCase() + ele.slice(1).toLowerCase(); }).join(" ");
            };

            var addresses, images, names;

            addresses = [
                "https://docs.google.com/spreadsheets/d/1pooEJHBtNuaBbF4c_AqHx0Jdrc4HQXgQN1ojpThM4No/edit?usp=sharing",
                "https://torim.prat.idf.il/",
                "https://forms.gle/J4U34rPon32s9DzP9",
                "https://docs.google.com/spreadsheets/d/1RcY94gjk-D6HArTPnzFlYmQbKIOxUfwpi5oJb8AuJxw/edit?usp=sharing",
                "https://docs.google.com/spreadsheets/d/1NYZyIt1nOf2cncN-9W-FEWAM_1-ew8qjkAyq3rwFknQ/edit",
                "https://bot.talpiot.org/react/page/front",
                "https://forms.gle/nVvf772kCpjeZeoW8",
                "https://rishum-net.huji.ac.il/site/student/login.asp",
                "https://docs.google.com/spreadsheets/d/1FFaD3aFURVp9g689GwJVk5-1pznCA33qFfOUbkB9d9Q/edit?usp=sharing",
                "https://drive.google.com/drive/folders/1U3f3ztubOwHJR4zR5cviINK_Pcu4KEa0?usp=drive_link"
            ]
            images = [
                "https://picsum.photos/200",
                "https://upload.wikimedia.org/wikipedia/commons/0/05/IDF_Medical_corps_Cap_badge.jpg",
                "https://upload.wikimedia.org/wikipedia/commons/thumb/4/45/Esculaap.svg/1200px-Esculaap.svg.png",
                "https://upload.wikimedia.org/wikipedia/commons/thumb/4/48/Eugen_von_Blaas_-_Sharing_the_News_1904.jpg/800px-Eugen_von_Blaas_-_Sharing_the_News_1904.jpg",
                "https://ynet-pic1.yit.co.il/picserver5/wcm_upload/2021/11/18/S1eE8LmNuK/_____2.jpg",
                "https://media.licdn.com/dms/image/C560BAQEbEeTZ4xuvdw/company-logo_200_200/0/1579355607267?e=2147483647&v=beta&t=20wMpLJdkqJaF6r-HGdoonyvFZm-SJI_T1bgM6sty54",
                "https://picsum.photos/206",
                "https://lh3.googleusercontent.com/A8OSgSxJPWRzxRvsiteUd1-MUX9NWHuA-LNKq4B6-UKex3uKeg57vxfEqxIsLyTaW5KCK_7oO_AzN7LwteptxsC7=w640-h400-e365-rj-sc0x00ffffff",
                "https://static.wixstatic.com/media/cbb0aa_c6f08b6336a34da1a95f1565ab9363cb~mv2.png/v1/fill/w_1308,h_1308,al_c/%D7%94%D7%90%D7%99%D7%A0%D7%99%D7%91%D7%A8%D7%A1%D7%99%D7%98%D7%94%20%D7%94%D7%A2%D7%99%D7%91%D7%A8%D7%99%D7%AA%20%D7%91%D7%99%D7%A8%D7%95%D7%A9%D7%9C%D7%99%D7%9D.png",
                "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARYAAAC1CAMAAACtbCCJAAABs1BMVEX///9ctZUAU0uFDB0AopN/g2r9//8VeYj//f8rEBcxmrj///7//P9btpX6//+Ii3t+g2ZXuJVispUAUkz2//////qHCxpuAACCABGgXme+3dVzAAB5AAD4//lWsJJoAAAAo5cqERcAp5QAAAB0eGBXqo7H5tssnbcsDhIASz0XAAAFn5gQfnFjgmoAVkx/gm4AODXMsreqio7+8vN5FSd1ABaCAAC7np7x29uQVVrDnKXcwsaDMT7YtbmCDhjj19qOSFCROEuEJDW1iY6WSk6bY2aUBRnNpar45eyKYWSfW2VgpI3k+vXW7+mv2s2ezr+Eu6id07+Kw6+kzb7x4t3K4ObB6eweiaVyrrxzKCy54+aol52q39tpHy9EeXJxAB9BVlMkj6FPr50slIVaKSykz9Z1xbmh0dp6gIc0lr7b/fxaER4VChZRUVI5Z3p+vbktkY4ZISJen7YvfGU1DBFDlH8YJjeXtbAhFhOTv9C05+UsGR8TFR8qanZAhYklFQ4mR1YaMzgkV14Lfocado4pKDYAaWxto6VYi4JdkJwIal60tqfP0sNif4BUdGE4Z08APSoTnDD8AAALYUlEQVR4nO2d+X8TxxXAR4fHI83u2JJ3V8L2CkkgbKMgA0IkXILWwYEgHxgsU8oRcCjYFBqOxElc07R2ba6m/Ml9s7vaQ1aIaT9h1fF8f+Ew/nzGX9689+btIYQkEolEIpFIJBKJRCKRSCQSya4EY0rDXkMXgkmV4rAX0XVgdOQoZWGvouvA1WO1qoyWAJhgNHH8+KeQYMJeSjfBCP5sr5GtKdKKH8LoiWzMGDqJiBTjQdGpzGTdMI5VpRYflJyezNZjscwRxDAJezXdAtbOZEBK3Rg6S7DMui766azBtdSqSBYjC8vCmYwBWgzjBJJabDBDCjqXNWATGZkJJLXYQC6h0LNYqSVziv9RakG8CDH95HAMYqVeH4LUQmQh4kDfT89lQUu9nv0dHBjlJrKgoOX3kG8hXLIT9t+EvKKuADaRoyWW/XzPnj3nzx8Je0ldAUP657YWiBdgWGrhaISez8ZaGLGhs2GvqBsgTEETfi2ZathL6gqwop0Z9rTUj+lhr6gbIEjRLgx5WrJfhr2i7uFctm7YRbp+fCLsxXQPXwxN2sWoXh/+IuzFdA/V2y0t2aFTssttwSaGshbDxzMX5MWiFmb14okv91hcpFrYq+kaFMX7PZFnohYKwQwrgKbJeYuHSYmicCEQNkzmlha6TjGiAMG6LrvcFgwTZ+9oWF5A88Da4PQgZ1qTKdeF4MalnMUlqcWDoEYpFQFSJU1uIh9TJW4lopYaYa+ki8CgRbW8SC0+XC1qaSrstXQRDB3IOdEitXgwNJiT0dKB6VzaipbcASQrUQuMrth7SGrxg9FMytEyKLW4MFeLKrV4YDRnb6J0bhrJOzlaEDSbc7TMyGBxIWw24uQWqcWDaJecSqTOyOGcC9FKLS1zUosLaZQidjuXmpVaXECLKrVsp1FKSS3bmSo57VxqVl5U9GhNoSKpS1KLx4GS07eo6Ybscl2ccYs1zJVaXAZzrdwitfiYzqVUOfrfxmWnm1MjuSkZLS6XcxFXS9hr6SLmVKmlA7OpiOpoORD2WroHNtuKFjU3GPZiugeWdk6KqqpOh72Y7kFLtybcUosPU2rpRKPkabkS9mK6Bz6cs2/7SbVr0SlRCL56lDC26+5Nnco5WtSUOhP8EsWMMeX03irefY9Iu1pgF80Gv0Qwo+hiNjuBCNltWg6oarrVucy2/exMJyczMSNzQdl1j0gfcI5EEQiatmEu0dCZvUYsdvwowsQMfAljKvaV2cFc2h5xq/Br24xbu5CxnjXKVDUavMEbY50oSGCmUz4twWGuVrXe7RKLDU8g1nbLrg5l6iOu8qNz5Ze1oD1Z5zHGvVUWlECw1i5KLGZ+WcvEsFGzH3qFcAmmXIXNzwt9VYmPW+xKlErn3Lyq6xo6knEfBZ7c673FkOqMUb25cI0xyMmi7iTQ4vQtoMUb5jL82V7fg+PDE64WnmxZcyG50NSJuK8em+2oBePqH5wnXrmW2qT30kuMFXx9IZlMXoPyJGw3E9DiTS3JiWHXivX+tZPul3RmWYFwIbqQXR5/wU+6lVvUVGuYSxnCf8z4rMTg91CM+HdA44uuLywlR0aSS9ewzoTUgonmNrmpSKpkDXMVneIbn9xsVSGH4ZMQGRibGN+zYoWHy7wu5C7CiDT8WuwZN2FKM168ddsIaIndrmrI1BXmWkmOQHYRsXmBaPG0qKDFnnGz5cV4ufjVZMCLMXwSYZPi+66VZPLOvJAPfQa0RFpaML5bLOfzi18HgqVer1VN6sTKiGVl6c49MbUQZcrToqq5aX4G1P4Uz8fz5fitWt2oeRFjDH2q4/t3kkvODhpZSl5DQt73Dd1YQEvEGs/dWMzni/F8sfhVbNIfL9mat4NGuJ2ny4KmXIIGA9FyGela85s8aCnm8/HFm34vtezxBzxWrA00srQEhYgJqgXhoJYZRJfL5TgogV2Uz9+67b1QK1avPfxz0sede0jM4QIcafC0L+VGInNIuxvnQGqJF8vFR0aWvzTWsDq6h6uFx56VkR/4R0mIqEWBTTSjujPLdDoyx/5SjLvk89/cnKzDQdHy8nB0NfEkueQUoeRTTcQixOFPg1/2xQpoueGzAvESf1Yz6jUeKscejhYKidHHI3YlWlpoUGGHlsx9mMhq59Lpu/FiPuCl+KgG8RLjVlYLicTzJ0+dvv86FTVY2rSk1HT6dT7v01KE5Lv4tVGvGzxWEonEamH08dIdbuU+nKZE7Ps50OTiWVdLRE2/HrB2TiBebt2u1x0riUJh9MlTnl2uMTEbOQuMFfcZK86zKGjJB7XE44+M2sPnlhXwMnqQF6OnYt+SiZGW9irRt2MDA9D1B6WUYRtZ2dbR8vy7kaWFpi7qBrIIaCmBlWi5XUu+XFw5uLrqaEl8P5p4vHAPi5tubRrpVhnKVaKgZTFeDmopFn9EDw46UhKj3xeef/eDJuas0ofmvLuFp9toNDqwWCz7N1A8vvgjMfFqYjRRsLUkEvvmkSn0HkL8ph++iVKpyDNuZZuW4uKPimLis/sStpbE6Ohf114wIvYnpbXe3aKq3w500AJn6CYyGSN8GxWcSrS2sXmdYKGvKIIW+6kZSLeVlhZfzl1sUp0RRdeVVbsW/S3xU2/vxgssbtNiY7/S5m7UihVLiz+xNBG/Is/fL8a30Wqi8PzvvcDavNgF2n7GKp2uOFai0U8cLXwQFW8qitaaHPBtxBML19L7SuhgwfxhItDybCzargUK8+IUUkyzpaUK2+j5wbV1S8vmfKjr/o3BGE9DaYbudpsWsLJMsWY6JQdS7Nl9hcI/1i0tG+svQl75bwpkzhnV7m79Wqycu7iMTUIItu94wXDWfrDvp16uZb13g4eLuDUaE3RZLY1VPC0DoCVfhkN0fhmRYNNG9X/aO8jiBdNNEQeWHNAyF6mMVaKBaMlbsaIo7R8/Q+Y3PS2bTUXYT3kFLbPPopWoD66lGC8vUwW1z2qJttXrCxdMRNVCCXrpTyzA6yIfbDco1ikORgs2dc2zsrHWFLKl4z8z1t8GnEBueV0sl2EH0e2HQWrqeHBzY8NOMBvrr5Cw0wXzUJuWymuIlWWNdJhfU50StgV1yEm8a00xU66u632Hom1eXpfLDQVrHZp7MAVN77ojZR16F1G19PW0axmo3NUoHA87nXkwHI7IoFuN1rZEzC3wv/9mvP+Qr8HluXfslkYVU6cdb3LCjOloC5o5nlt6XzGzw7/5f0ehb/f39B8a8MqzbQW9t+5SvbHmVKKGkJfl6dX9PUEt0crYvzSskPfdPMkoub7ZuwHd/3Wkixgt5vi4pcWXWMAK4ceg93wXI4rV1G2uYCjiH22xH4++8Z7+/v6fB/xWMDV/5ZlECl0dbKP1V1i8TzLltwG+gS0E0fKzM6uEdDv2UlPQrz/BCr3v/OaLhoDXWqHKvLWs9HjRwvMKIzv7WdnWvJj3cFzd329r+bejpfLuJcaE7OgTZyhlipAfH6GP21Y8LYe3GL/ha2cXC5kp3K3+lPcefT09444WCBRoWA5vIQWy7c7SKIF+T7RP1YBsq79xYgUAJ5XKwOEVpgn2c34g0NbbRcjRwr28W0GaqCOlHUL0tz4rlpbDK2jXvSpgG+Z+bwv1HBqrRC0rorVmHwDll00h3fa7XqD3H3i3gu3WbLfGC281qNXz+7QcXsGiFdsPhNdmnm69TdR/CLLtbk8rlELP3+8Llp6e/SvaLs4qNqBlHA7NfitvoTKFvawuoM9zAobAioTj0yKtePi1SCsuPi08r4S9nG7B1jIud1AQJ1osKzJWXGwtMlbacLTsvypjxY+the8gEWex/zV9vPeHWJEE6OuXVjrQJ610oo9bEfJNNP8TfTxWpJZ2+uQO6gA15XRFsjNkTpFIJBKJRCKRfFz+A74ChcU9nPR7AAAAAElFTkSuQmCC"
            ];
            names = [
                "תורנויות",
                0,
                "פניות לאחראי רפואה",
                "כביסה",
                "שמירות",
                0,
                "בקש\"צים",
                0,
                "בעיות רישום אוניברסיטה",
                "פטורים"
            ];

            const length = addresses.length;
            const container = document.getElementById('container');
            container.innerHTML = "";

            for (let i = 0; i < length; i++) {
                var name = link_to_title(addresses[i], i);
                var fontSize = name.length > 15 ? "1.2vw" : "1.8vw";
                var linkFontSize = addresses[i].length < 27 ? "1.2vw" : addresses[i].length < 34 ? "1vw" : "0.7vw";
                container.innerHTML += `
                    <div class="blob" onclick="clicked(${i});">
                        <h1 style="font-size: ${fontSize}">${name}</h1>
                        <img src="${images[i]}" alt="" onload="setTimeout(taintParent, 200, this)">
                        <h2 style="font-size: ${linkFontSize}">${addresses[i]}</h2>
                    </div>
                `;
            }

            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            function clicked(i) {
                if (malfromed_link()) return;

                window.location.assign(addresses[i]);
            }

            function openAll() {
                if (malfromed_link()) return;

                for (var i = length - 2; i >= 0; i--) {
                    openInNewTab(addresses[i]);
                }

                window.location.replace(addresses[length - 1]);

            }

            function openInNewTab(href) {
                Object.assign(document.createElement('a'), {
                    target: '_blank',
                    rel: 'noopener noreferrer',
                    href: href,
                }).click();
            }

            function link_to_title(a, i) {
                if (names[i] != 0) return names[i];
                a = a.split('/')[2]; // returns main part (domain name)
                a = a.split('.'); // splits to subdomain, domain, TLD

                return (a[1] + ' ' + a[0]).capitalise();
            }

            function malfromed_link() {
                return false;
            }

            function taintParent(x) {
                try {
                    x.crossOrigin = "Anonymous"; // workaround for _some_ images whose crosssite policy is not good.
                } catch (error) {
                    console.error(error);
                    x.src = "https://picsum.photos/210";
                    setTimeout(taintParent, 200, this);
                    return;
                }

                // create a virtual canvas and paint the image onto it.
                const canvas = document.createElement("canvas");
                const ctx = canvas.getContext("2d");
                canvas.width = x.width;
                canvas.height = x.height;
                const scale = 16;
                ctx.drawImage(x, 0, 0, x.width / scale, x.height / scale);
                
                // read the image data from the canvas.
                if (x.width == 0) return;
                const imageData = ctx.getImageData(0, 0, x.width / scale, x.height / scale);
                const data = imageData.data;
                const avg = getAvgColor(data); // algorithm that picks the average colour but more saturated
                x.parentElement.style.backgroundColor = rgbify(avg);
                
                let distinctColors = extractDistinctColors(data, avg, 4, 30); // extracts up to 4 distinct colours from the image.
                
                try {
                    // if the last colour is almost black, make the text on it white.
                    if (euclideanDistance(distinctColors[distinctColors.length - 1], [0, 0, 0]) < 80) {
                        x.parentElement.children[0].style.color = 'white';
                    } else {
                        x.parentElement.children[0].style.color = 'black';
                    }

                    // if the first colour is almost black, make the text on it white.
                    if (euclideanDistance(distinctColors[0], [0, 0, 0]) < 80) {
                        x.parentElement.children[2].style.color = 'white';
                    } else {
                        x.parentElement.children[2].style.color = 'black';
                    }
                } catch (error) {
                    console.error(error)
                }
                
                // create a valid CSS linear gradient.
                distinctColors = distinctColors.map(rgbify);
                let gradient = "linear-gradient(0deg, ";
                for (let i = 0; i < distinctColors.length; i++) {
                    gradient += distinctColors[i];
                    gradient += " ";
                    gradient += Math.floor(i * 100 / distinctColors.length);
                    gradient += "%, ";
                    gradient += distinctColors[i];
                    gradient += " ";
                    gradient += Math.floor((i+1) * 100 / distinctColors.length);
                    gradient += "%, ";
                }
                gradient = gradient.substring(0, gradient.length - 2);
                gradient += ')';

                // use the gradient as the background of the parent of the image.
                x.parentElement.style.background = gradient;
            }

            function rgbify(color) {
                const [r, g, b] = color;
                return `rgb(${Math.floor(r)}, ${Math.floor(g)}, ${Math.floor(b)})`;
            }

            function getAvgColor(data) {
                // sums up all the R, G, B values, unless they are brighter than 250 or dimmer than 5,
                // divides by the count (a.k.a taking the average).
                let totalR = 0;
                let totalG = 0;
                let totalB = 0;

                for (let i = 0; i < data.length; i += 4) {
                    let [r, g, b] = [data[i], data[i + 1], data[i + 2]];
                    let bright = 0.2126 * r + 0.7152 * g + 0.0722 * b;
                    if (bright > 250 || bright < 5) continue;
                    totalR += r;
                    totalG += g;
                    totalB += b;
                }

                const pixelCount = data.length / 4;
                let r = totalR / pixelCount;
                let g = totalG / pixelCount;
                let b = totalB / pixelCount;

                return [r, g, b];
            }

            function euclideanDistance(color1, color2) {
                // d = √(Δr² + Δg² + Δb²)
                const [r1, g1, b1] = color1;
                const [r2, g2, b2] = color2;
                return Math.sqrt((r1 - r2) ** 2 + (g1 - g2) ** 2 + (b1 - b2) ** 2);
            }

            function hue(red, green, blue) {
                let min = Math.min(Math.min(red, green), blue);
                let max = Math.max(Math.max(red, green), blue);

                if (min == max) {
                    return 0;
                }

                let hue = 0;
                if (max == red) {
                    hue = (green - blue) / (max - min);
                } else if (max == green) {
                    hue = 2 + (blue - red) / (max - min);
                } else {
                    hue = 4 + (red - green) / (max - min);
                }

                hue = hue * 60;
                if (hue < 0) hue = hue + 360;

                return Math.round(hue);
            }

            function colorDistance(color1, color2) {
                const [r1, g1, b1] = color1;
                const [r2, g2, b2] = color2;
                const hue1 = hue(r1, g1, b1);
                const hue2 = hue(r2, g2, b2);
                const bright1 = 0.2126 * r1 + 0.7152 * g1 + 0.0722 * b1;
                const bright2 = 0.2126 * r2 + 0.7152 * g2 + 0.0722 * b2;
                let factor = 1;
                if (Math.abs(hue1 - hue2) < 20) factor *= 0.5;
                if (Math.abs(hue1 - hue2) > 200) factor *= 1.5;
                if (Math.abs(bright1 - bright2) > 200) factor *= 1.1;
                return euclideanDistance(color1, color2) * factor;
            }

            function extractDistinctColors(imageData, avg, N, threshold) {
                const pixelCount = imageData.length / 4; // Assuming 4 bytes per pixel (RGBA)
                const countThreshold = 0.025 * pixelCount;

                // 1) Unique-ify the data with a threshold.
                const uniques = [];

                for (let i = 0; i < pixelCount; i++) {
                    const startIndex = i * 4; // Each pixel has 4 bytes (RGBA)
                    const rgb = [imageData[startIndex], imageData[startIndex + 1], imageData[startIndex + 2]];

                    let isUnique = true;

                    for (let j = 0; j < uniques.length; j++) {
                        let existingColor = uniques[j].color;
                        if (colorDistance(rgb, existingColor) < threshold) {
                            isUnique = false;
                            if (colorDistance(avg, existingColor) < colorDistance(avg, rgb)) {
                                uniques[j].color = rgb;
                            }
                            uniques[j].count++;
                            break;
                        }
                    }

                    if (isUnique) {
                        uniques.push({color: rgb, count: 1});
                    }
                }

                // 2) Sort by distance from avg.
                const sortedColors = uniques
                .filter(({ count }) => count >= countThreshold)
                .map(({ color, count }) => ({ color, count, distance: colorDistance(color, avg) }))
                .sort((a, b) => b.distance - a.distance);

                // 3) Extract the first N colors.
                return sortedColors.slice(0, N).map(item => item.color);
            }


        </script>
    </body>

</html>
